name: Pull Request

on: [pull_request]

jobs:
    analyze:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v1
            - name: Run PHP-CS Fix Check
              uses: docker://oskarstark/php-cs-fixer-ga
              with:
                  args: --config=.php_cs.dist --allow-risky=yes --diff --dry-run
            - name: Run PHPStan
              uses: docker://oskarstark/phpstan-ga
              with:
                  args: analyse src/ --level=max

    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v1
            - name: Install dependencies
              run: composer install --prefer-dist --no-progress --no-suggest
            - name: cache

    test:
        strategy:
            max-parallel: 15
            matrix:
                php-versions: ['5.6', '7.0', '7.1', '7.2', '7.3']
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v1
            - name: Setup PHP
              uses: shivammathur/setup-php@master
              with:
                  php-version: ${{ matrix.php-versions }}
            - name: Install dependencies
              run: composer install --prefer-dist --no-progress --no-suggest
            - name: Run tests
              run: make tests
