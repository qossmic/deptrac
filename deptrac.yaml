services:
  - class: Internal\Qossmic\Deptrac\IgnoreDependenciesOnContract
    tags:
     - { name: kernel.event_listener, event: Qossmic\Deptrac\Contract\Analyser\ProcessEvent }

deptrac:
  paths:
    - ./src

  analyser:
    types:
      - class
      - class_superglobal
      - file
      - function
      - function_superglobal
      - function_call

  formatters:
    graphviz:
      pointToGroups: true
      groups:
        Contract:
          - Contract
        Supportive:
          - Supportive
          - File
        Symfony:
          - Console
          - DependencyInjection
          - OutputFormatter
        Core:
          - Analyser
          - Ast
          - Dependency
          - InputCollector
          - Layer

  layers:
    # Domains
    - name: Analyser
      collectors:
        - type: directory
          value: src/Core/Analyser/.*
      allowed_dependencies:
        - Layer
        - Dependency
        - Ast
    - name: Ast
      collectors:
        - type: directory
          value: src/Core/Ast/.*
        - type: className
          value: ^PHPStan\\PhpDocParser\\.*
          private: true
        - type: className
          value: ^PhpParser\\.*
          private: true
        - type: className
          value: ^phpDocumentor\\Reflection\\.*
          private: true
      allowed_dependencies:
        - File
        - InputCollector
    - name: Console
      collectors:
        - type: directory
          value: src/Supportive/Console/.*
      allowed_dependencies:
        - Analyser
        - OutputFormatter
        - DependencyInjection
        - File
        - Time
    - name: Dependency
      collectors:
        - type: directory
          value: src/Core/Dependency/.*
      allowed_dependencies:
        - Ast
    - name: DependencyInjection
      collectors:
        - type: directory
          value: src/Supportive/DependencyInjection/.*
    - name: Contract
      collectors:
        - type: directory
          value: src/Contract/.*
    - name: InputCollector
      collectors:
        - type: directory
          value: src/Core/InputCollector/.*
      allowed_dependencies:
        - File
    - name: Layer
      collectors:
        - type: directory
          value: src/Core/Layer/.*
      allowed_dependencies:
        - Ast
    - name: OutputFormatter
      collectors:
        - type: directory
          value: src/Supportive/OutputFormatter/.*
        - type: className
          value: ^phpDocumentor\\GraphViz\\.*
          private: true
      allowed_dependencies:
        - DependencyInjection
    - name: File
      collectors:
        - type: directory
          value: src/Supportive/File/.*
    - name: Time
      collectors:
        - type: directory
          value: src/Supportive/Time/.*
    - name: Supportive
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: src/Supportive/.*/.*
          must:
            - type: directory
              value: src/Supportive/.*
